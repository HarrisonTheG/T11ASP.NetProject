@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
    ViewBag.Title = "ShoppingCart";
    double subtotal = 0;
    var total = 0.0;
    int count = 0;

    List<CartDetails> shoppingcart = (List<CartDetails>)ViewData["currentShoppingCart"];

    //var count = 0;
    Dictionary<ProductList, int> cartContent = (Dictionary<ProductList, int>)ViewData["cartContent"];


    var totalPrice = 0.0;
    if (cartContent != null)
    {
        foreach (KeyValuePair<ProductList, int> entry in cartContent)
        {
            totalPrice = (double)entry.Value * entry.Key.UnitPrice + (double)totalPrice;
        }
    }

}

@section scripts{
    <script src="/js/Cart2.js"></script>
}

<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

<link rel="stylesheet" href="~/css/Cart.css">

<div id="dvContents">
    <table class="table table-hover" width="100%" height="100%">
        <thead>
            <tr>
                <th>ID</th>
                <th>Item</th>
                <th>Product</th>
                <th>Price</th>
                <th>Quantity</th>
                <th>Item Total</th>
            </tr>
        </thead>
        <tbody>
            @if (cartContent == null)
            {
                @*if the customer is logged in, he can see his cart*@
                if (shoppingcart != null)
                {
                    @foreach (var entry in shoppingcart)
                    {
                        <tr>
                            <td>
                                @{
                                    count++;}@count
                                </td>
                                <td>
                                    <img src=@entry.ProductList.ImgUrl style="overflow:hidden; position:relative;width:50px;height:50px" />
                                </td>
                                <td>@entry.ProductList.ProductName</td>
                                <td>$@entry.ProductList.UnitPrice</td>
                                <td>
                                    @*<a asp-controller="AddtoCart" asp-action="additem" asp-route-id="@entry.Key.ProductID" class="btn btn-success">Add</a>*@
                                    <input id=@entry.ProductId class="quantityInput" type="number" min="1" tyle="width:30px" name=@("prodId"+entry.ProductId) value="@entry.Quantity" />
                                    @*<a asp-controller="AddtoCart" asp-action="delete" asp-route-id="@entry.Key.ProductID" class="btn btn-warning">Remove</a>*@
                                </td>
                                <td>@{subtotal = entry.Quantity * entry.ProductList.UnitPrice;}<span id=@("itemSubtotal"+ entry.ProductId)>@subtotal</span></td>
                                <td>

                                    <a id=@("cancel" + entry.ProductId) class="btn btn-danger" asp-controller="Cart" asp-action="Removeitemfromcart" asp-route-productId="@entry.ProductId" asp-route-quantity="@entry.Quantity" asp-route-cartId="@entry.CartId" )>Delete Item</a>

                                </td>
                            </tr>
                        }

                }
                else
                {
                    <tr>
                        <td style="font-size:20px">
                            There are no items in the cart
                        </td>
                    </tr>

                }
            }
            else
            {
                @*if the customer add item and login to his account*@

                @foreach (KeyValuePair<ProductList, int> entry in cartContent)
                {
                    <tr>
                        <td>
                            @{
                                count++;}@count
                            </td>
                            <td>
                                <img src=@entry.Key.ImgUrl style="overflow:hidden; position:relative;width:50px;height:50px" />
                            </td>
                            <td>@entry.Key.ProductName</td>
                            <td>$@entry.Key.UnitPrice</td>
                            <td>
                                @*<a asp-controller="AddtoCart" asp-action="additem" asp-route-id="@entry.Key.ProductID" class="btn btn-success">Add</a>*@
                                <input id=@entry.Key.ProductId class="quantityInput" type="number" min="1" tyle="width:30px" name=@("prodId"+entry.Key.ProductId) value="@entry.Value" />
                                @*<a asp-controller="AddtoCart" asp-action="delete" asp-route-id="@entry.Key.ProductID" class="btn btn-warning">Remove</a>*@
                            </td>
                            <td>@{subtotal = (double)entry.Value * entry.Key.UnitPrice;}<span id=@("itemSubtotal"+ entry.Key.ProductId)>@subtotal</span></td>
                            <td>

                                <a id=@("cancel" + entry.Key.ProductId) class="btn btn-danger" asp-controller="Cart" asp-action="DeleteItem" asp-route-id="@entry.Key.ProductId" asp-route-qty="@entry.Value" )>Delete Item</a>

                            </td>
                        </tr>
                    }}
        </tbody>

        <tfoot>

            <tr>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td>
                    Total
                </td>
                <td>
                    <a asp-controller="">
                        $<span id="totalPrice">@totalPrice</span>
                    </a>
                </td>
                <td></td>
            </tr>
        </tfoot>
    </table>

    <div id="footer" width="100%" height="60px">
        @*<button type="button" id="btnprint" class="btn btn-primary" disabled>Print</button>*@
        <a asp-controller="Home" asp-action="index" class="btn btn-success">Continue Shopping</a>
        <a type="button" id="btn" class="btn btn-warning" asp-controller="Checkout" asp-action="index">Place Order</a>


    </div>

</div>

<script>
    <script type="text/javascript">
        function refreshpage(e) {
            e = e || window.event;
        var key = e.keyCode;
        (if key == 13) {
            return true;
        }
    }
</script>


</script>